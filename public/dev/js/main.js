// Generated by CoffeeScript 1.3.3
$(document).ready(function() {
  var jPlayerDiv, playSong, setTitle, curSongDiv, firstSongDiv, firstSong;

  console.log("IN MAIN");

  $('#jp-no-solution-wrapper').hide();

  setTitle = function(title) {
    return $('#jp-title-text').html(title);
  };

  jPlayerDiv = $("#jquery_jplayer_1");
  curSongDiv = $('#curSongID');
  firstSongDiv = $('#allSongs').children(':first');
  firstSong = {
    id: firstSongDiv.attr('id'),
    url: firstSongDiv.html(),
    title: firstSongDiv.attr('title')
  };

  jPlayerDiv.jPlayer({
    ready: function() {
      playSong(firstSong.id, firstSong.url, firstSong.title, true);
      },
    supplied: 'mp3',
    solution: 'html,flash',
    wmode: 'window',
    swfPath: 'scripts',
    volume: '1.0',
  });

  playSong = function(songID, songUrl, songTitle, dontStartPlaying) {
    curSongDiv.html(songID);
    if (dontStartPlaying) {
      jPlayerDiv.jPlayer("setMedia", {
        mp3: songUrl + '.mp3',
      }).jPlayer();
    } else {
      jPlayerDiv.jPlayer("setMedia", {
        mp3: songUrl + '.mp3',
      }).jPlayer('play');
    }
    return setTitle(songTitle);
  };

  playSong(firstSong.id, firstSong.url, firstSong.title, true);

  jPlayerDiv.bind( $.jPlayer.event.ended , function(e) {
    var curSongID, curSong, nextSong, songUrl, songTitle, songID
    curSongID = curSongDiv.html();
    curSong = $('#'+curSongID);

    if (curSong) {
      nextSong = curSong.next();
      if (nextSong) {
        songID = nextSong.attr('id');
        songUrl = nextSong.html();
        songTitle = nextSong.attr('title');
        return playSong(songID, songUrl, songTitle);
      }
    }

  });

  $('.playableSong').click(function(e) {
    var songDiv, songTitle, songUrl, songID;
    e.preventDefault();
    songDiv = $(this);
    songUrl = songDiv.attr('url');
    songTitle = songDiv.attr('title');
    songID = songDiv.attr('id');
    return playSong(songID, songUrl, songTitle);
  });

  $('#soundCloudLink').css({
    position: 'relative',
    left: 45,
    top: 8
  }).show();

  setTimeout(function() {
    return $('#jp-no-solution-wrapper').show();
  }, 5000);

  function showAbout(e)
  {
    e.preventDefault();
    var aboutModal = $('#aboutModal');
    aboutModal.animate({top:"-30px"},500);
    aboutModal.addClass('show_about');
    $('#modalDim').fadeIn(500);
  }

  function hideAbout(e)
  {
    e.preventDefault();
    var aboutModal = $('#aboutModal');
    aboutModal.removeClass('show_about');
    aboutModal.animate({top:"-570px"},500);
    $('#modalDim').fadeOut(500);
  }

  $('.aboutButton').click(function(e) {
    var aboutModal = $('#aboutModal');
    if ( aboutModal.hasClass('show_about') )
    {
      hideAbout(e);
    } else {
      showAbout(e);
    }
  });

  $('#modalDim').click(function(e) {
    hideAbout(e);
  });

});
